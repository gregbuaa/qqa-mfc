from eval_utils import*

datas_file = "cwq"
out = "'answer.json' generated by get_answer.py"



datas, question_string = prepare_dataset_for_eval(datas_file)
output_datas = output_an(out)


total_answer = len(output_datas)
true_answer = 0

for outputs in output_datas:
    sign = 1
    question = outputs['question']
    data = [d for d in datas if d[question_string] == question][0]
    answers = data['answer']


    if '{' in outputs['answer'] and '}' in outputs['answer']:
        answer = outputs['answer'].split('{')[1].split('}')[0]
        sign = 2
    else:
        answer = outputs['answer']
    
    if answer.lower() in answers.lower() or answers.lower() in answer.lower():
        true_answer += 1
        continue


print("true:", true_answer)
print("error:", total_answer-true_answer)
print("total:", total_answer)